<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    /* (ê¸°ì¡´ CSS ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•˜ë¯€ë¡œ ìƒëµ - ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”) */
    body { font-family: 'Apple SD Gothic Neo', sans-serif; background: #f4f7f6; margin: 0; padding: 0; height: 100vh; overflow: hidden; }
    .app-container { display: flex; flex-direction: column; height: 100%; }
    .header { padding: 15px; background: white; border-bottom: 1px solid #ddd; font-weight: bold; font-size: 1.2rem; text-align: center; }
    .content { flex: 1; overflow-y: auto; padding: 15px; box-sizing: border-box; }
    .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    #timer { font-size: 3.5rem; font-weight: bold; margin: 10px 0; color: #333; text-align: center; }
    .rating { display: flex; justify-content: center; flex-direction: row-reverse; gap: 8px; margin: 10px 0; }
    .rating input { display: none; }
    .rating label { font-size: 2.2rem; color: #ddd; cursor: pointer; }
    .rating input:checked ~ label { color: #f1c40f; }
    button { padding: 16px; font-size: 1rem; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; transition: 0.2s; }
    .btn-blue { background: #3498db; color: white; }
    .btn-green { background: #2ecc71; color: white; }
    .btn-red { background: #e74c3c; color: white; }
    .btn-orange { background: #e67e22; color: white; }
    .btn-purple { background: #9b59b6; color: white; }
    input, select, textarea { width: 100%; padding: 12px; margin: 6px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }
    .label { text-align: left; font-size: 0.85rem; color: #666; font-weight: bold; margin-top: 8px; }
    #history-layer { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 100; overflow-y: auto; padding: 20px; box-sizing: border-box; }
    .history-card { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-bottom: 10px; text-align: left; border-left: 5px solid #3498db; font-size: 0.9rem; }
  </style>
</head>
<body>

<div class="app-container">
  <div class="header">ğŸ”ï¸ SAT PEAK ì›ì • í›ˆë ¨ ì¼ì§€</div>
  
  <div class="content">
    <div id="morning-box" class="card" style="background: #e8f4fd;">
      <div class="label">â˜€ï¸ ê¸°ìƒ í›„ ì»¨ë””ì…˜ ì²´í¬</div>
      <div class="rating">
        <input type="radio" name="star" id="star5" value="5"><label for="star5">â˜…</label>
        <input type="radio" name="star" id="star4" value="4"><label for="star4">â˜…</label>
        <input type="radio" name="star" id="star3" value="3" checked><label for="star3">â˜…</label>
        <input type="radio" name="star" id="star2" value="2"><label for="star2">â˜…</label>
        <input type="radio" name="star" id="star1" value="1"><label for="star1">â˜…</label>
      </div>
      <div id="condition-text" style="font-size: 0.85rem; color: #666; margin-bottom: 10px; text-align: center;">ë³´í†µ (í›ˆë ¨ ê°€ëŠ¥)</div>
      <button id="btn-morning" class="btn-blue" onclick="saveMorning()">ì»¨ë””ì…˜ ì €ì¥ í›„ ì‹œì‘</button>
    </div>

    <div class="card">
      <select id="type">
        <option value="ê³„ë‹¨">ğŸƒ ê³„ë‹¨ ì˜¤ë¥´ë‚´ë¦¬ê¸°</option>
        <option value="ë°”ì¼íœ˜ë‘ë¥´ê¸°">â›ï¸ ë°”ì¼ íœ˜ë‘ë¥´ê¸°</option>
        <option value="ìŠ¤ì¿¼íŠ¸">ğŸ‹ï¸ ìŠ¤ì¿¼íŠ¸</option>
        <option value="ëŸ¬ë‹">ğŸ‘Ÿ ëŸ¬ë‹</option>
        <option value="ë“±ë°˜">ğŸ§— ë“±ë°˜ í›ˆë ¨</option>
        <option value="ì¤‘ëŸ‰í•˜ì´í‚¹">ğŸ’ ì¤‘ëŸ‰ í•˜ì´í‚¹</option>
      </select>
      <div id="timer">00:00:00</div>
      <div style="display: flex; gap: 8px;">
        <button class="btn-green" style="width:50%" onclick="startTimer()">ì‹œì‘</button>
        <button class="btn-red" style="width:50%" onclick="stopTimer()">ì¤‘ì§€</button>
      </div>
    </div>

    <div class="card">
      <div id="dynamic-label" class="label">íšŒì°¨ / ìµœëŒ€ì‹¬ë°•ìˆ˜ / ì¤‘ëŸ‰(kg)</div>
      <div style="display: flex; gap: 5px;">
        <input type="number" id="lapOrDist" placeholder="íšŒì°¨" value="1">
        <input type="number" id="hr" placeholder="ì‹¬ë°•">
        <input type="number" id="weight" placeholder="kg">
      </div>
      <input type="text" id="pace" placeholder="ì¥ì†Œ/í˜ì´ìŠ¤" style="display:none;">
      <textarea id="memo" placeholder="í›ˆë ¨ ë©”ëª¨ (ë°°ë‚­ ë¬´ê²Œ, ì»¨ë””ì…˜ ë“±)"></textarea>
      <button id="btn-session" class="btn-blue" onclick="saveSession()">ì„¸íŠ¸ ê¸°ë¡í•˜ê¸°</button>
    </div>

    <button class="btn-orange" onclick="toggleSection('finish-box')">ğŸ ì˜¤ëŠ˜ì˜ í›ˆë ¨ ë§ˆê°í•˜ê¸°</button>
    <div id="finish-box" class="card" style="display:none; background:#fff5f5;">
      <div class="label">ì˜¤ëŠ˜ì˜ ì²´ê° ê°•ë„ (RPE)</div>
      <select id="intensity">
        <option value="7-8" selected>7-8 (ë§¤ìš° í˜ë“¦)</option>
        <option value="5-6">5-6 (ì ë‹¹í•¨)</option>
        <option value="3-4">3-4 (ê°€ë²¼ì›€)</option>
        <option value="9-10">9-10 (í•œê³„ ë„ë‹¬)</option>
      </select>
      <textarea id="review" placeholder="ì˜¤ëŠ˜ í›ˆë ¨ ì´í‰ (ì–´ê¹¨ ìƒíƒœ, ë¶€ìƒ ë¶€ìœ„ í†µì¦ ë“±)"></textarea>
      <button id="btn-daily" class="btn-red" onclick="saveDailyReport()">ìµœì¢… ë§ˆê° ì €ì¥</button>
    </div>

    <button class="btn-purple" onclick="openHistory()">ğŸ” ê³¼ê±° ê¸°ë¡ ì¡°íšŒí•˜ê¸°</button>
  </div>
</div>

<div id="history-layer">
  <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>ê¸°ë¡ ì¡°íšŒ</h2>
    <button onclick="closeHistory()" style="width:60px; padding:10px; background:#ddd; border-radius: 8px;">ë‹«ê¸°</button>
  </div>
  <input type="date" id="search-date">
  <button id="btn-load" class="btn-purple" onclick="loadHistory()">ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  <div id="history-display" style="margin-top:20px;"></div>
</div>

<script>
  // â˜… ì¤‘ìš”: ì—¬ê¸°ì— ë³¸ì¸ì˜ êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ URLì„ ë„£ìœ¼ì„¸ìš”.
  const API_URL = "https://script.google.com/macros/s/AKfycbx1I48YophSXQmbwXTHzR-1bdQcIz_d_LscQKp8HgqiwLBb2hDTeHgmYJBIExPFYSbQ2w/exec";

  let startTime, timerInterval, elapsedTime = 0;

  // ì•„ì¹¨ ì»¨ë””ì…˜ ê°€ì´ë“œ
  document.querySelectorAll('.rating input').forEach(input => {
    input.addEventListener('change', (e) => {
      const texts = { "1": "ë§¤ìš° ë‚˜ì¨ (íœ´ì‹)", "2": "í”¼ë¡œí•¨ (ì €ê°•ë„)", "3": "ë³´í†µ (ì •ìƒí›ˆë ¨)", "4": "ì¢‹ìŒ (ê°•ë„ë†’ì„)", "5": "ìµœìƒ (ì»¨ë””ì…˜ ì™„ë²½)" };
      document.getElementById('condition-text').innerText = texts[e.target.value];
    });
  });

  // UI ê°€ì´ë“œ ìë™ ì „í™˜
  document.getElementById('type').addEventListener('change', function() {
    const type = this.value;
    const label = document.getElementById('dynamic-label');
    const paceInput = document.getElementById('pace');
    const weightInput = document.getElementById('weight');
    const lapInput = document.getElementById('lapOrDist');

    lapInput.type = "number";
    paceInput.style.display = 'none';
    weightInput.style.display = 'block';

    if (type === 'ê³„ë‹¨') {
      label.innerText = "íšŒì°¨ / ìµœëŒ€ì‹¬ë°•ìˆ˜ / ì¤‘ëŸ‰(kg)";
      lapInput.placeholder = "íšŒì°¨";
    } else if (type === 'ëŸ¬ë‹') {
      label.innerText = "ê±°ë¦¬(km) / ìµœëŒ€ì‹¬ë°•ìˆ˜";
      lapInput.placeholder = "km";
      paceInput.style.display = 'block';
      paceInput.placeholder = "í˜ì´ìŠ¤ (ì˜ˆ: 05:30)";
      weightInput.style.display = 'none';
    } else if (type === 'ë“±ë°˜') {
      label.innerText = "í›ˆë ¨ë‚´ìš© / ìµœëŒ€ì‹¬ë°• / ê¸°ì˜¨(â„ƒ)";
      lapInput.type = "text";
      lapInput.placeholder = "ì˜ˆ: ë¹™ë²½ ë¦¬ë”©";
      paceInput.style.display = 'block';
      paceInput.placeholder = "ì¥ì†Œ (ì˜ˆ: ì„¤ì•…ì‚°)";
      weightInput.placeholder = "ê¸°ì˜¨";
    } else if (type === 'ì¤‘ëŸ‰í•˜ì´í‚¹') {
      label.innerText = "ê±°ë¦¬(km) / ìµœëŒ€ì‹¬ë°•ìˆ˜ / ì¤‘ëŸ‰(kg)";
      lapInput.placeholder = "km";
    } else {
      label.innerText = "íšŸìˆ˜ / ìµœëŒ€ì‹¬ë°•ìˆ˜ / ì¤‘ëŸ‰(kg)";
      lapInput.placeholder = "íšŸìˆ˜";
    }
  });

  function toggleSection(id) {
    const el = document.getElementById(id);
    el.style.display = el.style.display === 'none' ? 'block' : 'none';
  }

  function openHistory() { document.getElementById('history-layer').style.display = 'block'; }
  function closeHistory() { document.getElementById('history-layer').style.display = 'none'; }

  // í¼ ì´ˆê¸°í™” í•¨ìˆ˜
  function clearSessionForm() {
    document.getElementById('hr').value = "";
    document.getElementById('memo').value = "";
    document.getElementById('pace').value = "";
  }

  // ê³µí†µ ì €ì¥ í•¨ìˆ˜ (POST)
  async function sendData(data, btnId) {
    const btn = document.getElementById(btnId);
    btn.disabled = true;
    btn.innerText = "ì €ì¥ ì¤‘...";

    try {
      await fetch(API_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      alert("ë°ì´í„°ë¥¼ ë³´ëƒˆìŠµë‹ˆë‹¤! (ì‹œíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”)");
    } catch (e) {
      alert("ì˜¤ë¥˜ ë°œìƒ: " + e.message);
    } finally {
      btn.disabled = false;
      btn.innerText = (btnId === 'btn-morning' ? "ì»¨ë””ì…˜ ì €ì¥ ì™„ë£Œ" : (btnId === 'btn-daily' ? "ìµœì¢… ë§ˆê° ì™„ë£Œ" : "ì„¸íŠ¸ ê¸°ë¡í•˜ê¸°"));
    }
  }

  function saveMorning() {
    const star = document.querySelector('input[name="star"]:checked').value;
    const text = document.getElementById('condition-text').innerText;
    sendData({ type: "ì•„ì¹¨ì»¨ë””ì…˜", condition: star + "ì  (" + text + ")" }, 'btn-morning');
  }

  function saveSession() {
    const type = document.getElementById('type').value;
    const lapVal = document.getElementById('lapOrDist').value;
    const data = {
      type: type,
      time: document.getElementById('timer').innerText,
      lapOrDist: lapVal,
      hr: document.getElementById('hr').value,
      weight: document.getElementById('weight').value || "-",
      pace: document.getElementById('pace').value || "-",
      memo: document.getElementById('memo').value
    };
    sendData(data, 'btn-session').then(() => {
      if(type === "ê³„ë‹¨") document.getElementById('lapOrDist').value = parseInt(lapVal) + 1;
      clearSessionForm();
    });
  }

  function saveDailyReport() {
    sendData({
      type: "í›ˆë ¨ë§ˆê°",
      intensity: document.getElementById('intensity').value,
      review: document.getElementById('review').value
    }, 'btn-daily');
  }

  // ì—­ì‚¬ ì¡°íšŒ í•¨ìˆ˜ (GET)
  async function loadHistory() {
    const date = document.getElementById('search-date').value;
    if(!date) return alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    const btn = document.getElementById('btn-load');
    btn.innerText = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

    try {
      const resp = await fetch(`${API_URL}?date=${date}`);
      const records = await resp.json();
      const display = document.getElementById('history-display');
      display.innerHTML = records.length ? "" : "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
      records.forEach(r => {
        const div = document.createElement('div');
        div.className = 'history-card';
        div.innerHTML = `<strong>[${r.type}]</strong> ${r.time || "-"}<br>${r.lapOrDist || "-"} | ${r.hr || "-"}bpm | ${r.pace || "-"}<br><small>${r.review || r.memo || ""}</small>`;
        display.appendChild(div);
      });
    } catch (e) {
      alert("ì¡°íšŒ ì‹¤íŒ¨: " + e.message);
    } finally {
      btn.innerText = "ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°";
    }
  }

  function startTimer() { if (!timerInterval) { startTime = Date.now() - elapsedTime; timerInterval = setInterval(updateTime, 100); } }
  function stopTimer() { clearInterval(timerInterval); timerInterval = null; }
  function updateTime() {
    elapsedTime = Date.now() - startTime;
    let s = Math.floor(elapsedTime / 1000), m = Math.floor(s / 60), h = Math.floor(m / 60);
    document.getElementById("timer").innerText = (h>0?h+":":"")+(m%60<10?"0"+m%60:m%60)+":"+(s%60<10?"0"+s%60:s%60);
  }
</script>
</body>
</html>
